<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Es una página web dedicada a la gestion de datos de un Hospital">
    <meta name="author" content="Paula Venegas Roldán & Marco José Miranda Bahamonde">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Hospital Virgen del Camino</title>

    <link rel="stylesheet" href="../styles_main.css">
</head>
<body>
    <header>   
        <div class="Cabezera">
            <button title = "button" class="Menu_Hamburgesa1">
                <svg class="svg1" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"/>
                </svg>
            </button>
            
            <h1 class>Hospital Virgen del Camino</h1>
            <a href="../Main.html" >
                <img src="../Logo.png" alt = "Logo" class = "Logo">
            </a>
            <h2 class>Añadir Cita</h2>
        </div>

        <nav class = "nav1">
            <ul class = "nav1_ul1">
                <li class="li"><a href="Cita.html" class="a">Volver Cita</a></li>
                <li class="li"><a href="../Main.html" class="a">Volver al Menu</a></li>
            </ul>
        </nav>

    </header>

    <div class="Fondo">
        <form class = "Formulario" id = "Formulario" method="POST" action="AnadirCita.php">
            <!--Fecha de cita-->
            <div class="Formulario_Grupo" id = "Grupo_Fecha">
                <label for="nFecha" class = "Formulario_Label">Fecha de cita</label>
                <div class = "Formulario_Grupo_Input">
                    <input type="text" class = "Formulario_Input" name = "nFecha" id = "nFecha" placeholder="dd/mm/yyyy">
                    <i class="Icono fa-solid fa-circle-xmark"></i>
                </div>
                <p class = "Error">Fecha no valida </p>
            </div>

            <!--Hora de la cita-->
            <div class="Formulario_Grupo" id = "Grupo_Hora">
                <label for="nHora" class = "Formulario_Label">Hora de la cita</label>
                <div class = "Formulario_Grupo_Input">
                    <input type="number" class = "Formulario_Input" name = "nHora" id = "nHora" placeholder="Entre 0 y 24">
                    <i class="Icono fa-solid fa-circle-xmark"></i>
                </div>
                <p class = "Error">Solo numero enteros para la hora</p>
            </div>

            <!--Motivo de la cita-->
            <div class="Formulario_Grupo" id = "Grupo_motivo">
                <label for="nMotivo" class = "Formulario_Label">Motivo de la cita</label>
                <div class = "Formulario_Grupo_Input">
                    <input type="text" class = "Formulario_Input" name = "nMotivo" id = "nMotivo" placeholder = "Motivo aquí">
                    <i class="Icono fa-solid fa-circle-xmark"></i>
                </div>
                <p class = "Error">Introduzca valores correctos</p>
            </div>

            <!--Consulta-->
            <div class="Formulario_Grupo" id = "Grupo_Nombre">
                <label for="nConsulta" class = "Formulario_Label">Numero de la consulta</label>
                <div class = "Formulario_Grupo_Input">
                    <input type="number" class = "Formulario_Input" name = "nConsulta" id = "nConsulta" placeholder="1">
                    <i class="Icono fa-solid fa-times-circle"></i>
                </div>
                <p class = "Error">Solo puede introducir numeros</p>
            </div>

            <!--IdPaciente-->
            <div class="Formulario_Grupo" id = "Grupo_Nombre">
                <label for="nIdPaciente" class = "Formulario_Label">Id del paciente</label>
                <div class = "Formulario_Grupo_Input">
                    <input type="number" class = "Formulario_Input" name = "nIdPaciente" id = "nIdPaciente" placeholder="1">
                    <i class="Icono fa-solid fa-times-circle"></i>
                </div>
                <p class = "Error">Solo puede introducir numeros</p>
            </div>


            <!--Departamento-->
            <div class="Formulario_Grupo" id="Grupo_nomdpto">
                <label for="nNombreDepartamento" class="Formulario_Label">Departamento</label>
                <div class="Formulario_Grupo_Input">
                    <select class="Formulario_Select" name="nNombreDepartamento" id="nNombreDepartamento">
                        <option value="psiquiatria">Psiquiatría</option>
                        <option value="pediatria">Pediatría</option>
                        <option value="dermatologia">Dermatología</option>
                        <option value="traumatologia">Traumatología</option>
                        <option value="otorrinolaringologia">Otorrinolaringología</option>
                        <option value="neurologia">Neurología</option>
                        <option value="cardiologia">Cardiología</option>
                        <option value="administracion">Admnistración</option>
                        <option value="oftalmologia">Oftalmología</option>
                        <option value="ginecologia">Ginecología</option>
                    </select>
                </div>
                <p class="Error">Selecciona un departamento</p>
            </div>

            <div class="Formulario_Grupo" id="Grupo_doctor">
                <label for="nIdDoctor" class="Formulario_Label">Doctor</label>
                <div class="Formulario_Grupo_Input">
                    <select class="Formulario_Select" name="nIdDoctor" id="nIdDoctor" required disabled>
                        <option value="">Seleccione una especialidad primero</option>
                    </select>
                </div>
                <p class="Error">Selecciona un doctor</p>
            </div>
            

            <!--Mensaje-->
            <div class = "Formulario_Mensaje" id = "Formulario_Mensaje">
                <p><i class="fa-solid fa-triangle-exclamation"></i><b>Error: Por favor rellena el formulario correctamente</b></p>
            </div>

            <!--Botón-->
            <div class="Formulario_Grupo_Boton">
                <button type = "submit" class = "Formulario_Boton">Añadir Cita</button>
                <p class = "Exito" id = "Exito">Se ha añadido la cita correctamente</p>
            </div>
        </form>
    </div>

    <footer>
        <div class = "Contacto">
            <a href="../Main.html" >
                <img src="../Logo.png" alt = "Logo" class = "Logo">
            </a>
            <p>Hospital</p>
        </div>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Asignar el evento al select de especialidad
            document.getElementById('nNombreDepartamento').addEventListener('change', function() {
                let especialidad = this.value;
                let doctorSelect = document.getElementById('nIdDoctor');
                
                if (especialidad) {
                    // Mostrar estado de carga
                    doctorSelect.disabled = true;
                    doctorSelect.innerHTML = '<option value="">Cargando doctores...</option>';
                    
                    fetch('obtenerDoctores.php?especialidad=' + encodeURIComponent(especialidad))
                        .then(response => {
                            if (!response.ok) throw new Error('Error en la respuesta');
                            return response.json();
                        })
                        .then(data => {
                            if (data.length === 0) {
                                doctorSelect.innerHTML = '<option value="">No hay doctores disponibles en esta especialidad</option>';
                            } else {
                                doctorSelect.innerHTML = '<option value="">Seleccione un doctor</option>';
                                
                                data.forEach(doctor => {
                                    let option = new Option(
                                        doctor.Nombre + ' (' + doctor.HoraInicio + ':00-' + doctor.HoraFin + ':00)',
                                        doctor.IdDoctor
                                    );
                                    doctorSelect.add(option);
                                });
                            }
                            doctorSelect.disabled = data.length === 0;
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            doctorSelect.innerHTML = '<option value="">Error al cargar doctores</option>';
                            doctorSelect.disabled = true;
                        });
                } else {
                    doctorSelect.innerHTML = '<option value="">Seleccione una especialidad primero</option>';
                    doctorSelect.disabled = true;
                }
            });
        });
    </script>

</body>
</html>